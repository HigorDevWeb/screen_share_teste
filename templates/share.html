<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compartilhar Tela</title>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center min-h-screen">

    <!-- Container principal -->
    <div class="bg-white p-8 rounded-lg shadow-xl text-center max-w-md w-full">
        <!-- Título -->
        <h1 class="text-3xl font-extrabold text-blue-700 mb-4">Compartilhar Tela</h1>
        <p class="text-gray-600 mb-6">Inicie o compartilhamento de tela com apenas um clique!</p>

        <!-- Botão -->
        <button id="startButton" class="w-full px-4 py-3 bg-blue-500 text-white font-bold rounded-lg shadow-lg hover:bg-blue-600 transition">
            Iniciar Compartilhamento
        </button>
    </div>

</body>
<script>
    const socket = io("http://localhost:5000");
    let peerConnection;

    // Configuração com STUN e TURN
    const config = {
        iceServers: [
            { urls: ["stun:sp-turn2.xirsys.com"] },
            {
                username: "l-amMJx2myopJOX4qELJ2xqw58HXrw5ikBUIuYRsS--V-AHAobp8tVBKx6OfxN7iAAAAAGc58_VIaWdvcg==",
                credential: "7eee59f4-a4ea-11ef-9a19-0242ac120004",
                urls: [
                    "turn:sp-turn2.xirsys.com:80?transport=udp",
                    "turn:sp-turn2.xirsys.com:3478?transport=udp",
                    "turn:sp-turn2.xirsys.com:80?transport=tcp",
                    "turn:sp-turn2.xirsys.com:3478?transport=tcp",
                    "turns:sp-turn2.xirsys.com:443?transport=tcp",
                    "turns:sp-turn2.xirsys.com:5349?transport=tcp"
                ]
            }
        ]
    };

    document.getElementById("startButton").addEventListener("click", async () => {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        peerConnection = new RTCPeerConnection(config);

        stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));

        const offer = await peerConnection.createOffer();
        await peerConnection.setLocalDescription(offer);
        socket.emit("signal", { description: peerConnection.localDescription });

        socket.on("signal", async (data) => {
            if (data.description) await peerConnection.setRemoteDescription(data.description);
            if (data.candidate) await peerConnection.addIceCandidate(data.candidate);
        });

        peerConnection.onicecandidate = (event) => {
            if (event.candidate) socket.emit("signal", { candidate: event.candidate });
        };
    });
</script>
</html>
